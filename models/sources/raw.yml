version: 2

sources:
  - name: raw_cowjacket
    description: "Raw transactional tables loaded into Unity Catalog for CowJacket."
    catalog: cowjacket_catalog
    schema: cowjacket_schema

    tables:
      - name: customers
        description: "Customer master data."
        columns:
          - name: customer_id
            description: "Primary key for customers."
            tests:
              - not_null
              - unique

          - name: full_name
            description: "Full name of the customer."
            test: 
              - not_null

          - name: email
            description: "Customer email address (unique)."
            tests:
              - unique

          - name: join_date
            description: "Date when the customer created an account."
            tests:
              - not_null

      - name: products
        description: "List of all products sold."
        columns:
          - name: product_id
            description: "Primary key for products."
            tests:
              - not_null
              - unique

          - name: product_name
            description: "Name of the product."
            tests:
              - not_null

          - name: category
            description: "Category of the product (e.g., Shoes, Jackets)."
            tests:
              - not_null

          - name: price
            description: "Unit price of the product."
            tests:
              - not_null

      - name: orders
        description: "Customer orders."
        columns:
          - name: order_id
            description: "Primary key for orders."
            tests:
              - not_null
              - unique

          - name: customer_id
            description: "Links to customers.customer_id."
            tests:
              - not_null
              - relationships:
                  arguments:
                    to: source('raw_cowjacket', 'customers')
                    field: customer_id

          - name: order_date
            description: "Date the order was placed."
            tests:
              - not_null

          - name: total_amount
            description: "Total order amount."
            tests:
              - not_null

      - name: order_items
        description: "Line items inside each order."
        columns:
          - name: order_item_id
            description: "Primary key for order items."
            tests:
              - not_null
              - unique

          - name: order_id
            description: "Links to orders.order_id."
            tests:
              - not_null
              - relationships:
                  arguments:
                    to: source('raw_cowjacket', 'orders')
                    field: order_id

          - name: product_id
            description: "Links to products.product_id."
            tests:
              - not_null
              - relationships:
                  arguments:
                    to: source('raw_cowjacket', 'products')
                    field: product_id

          - name: quantity
            description: "Number of units purchased."
            tests:
              - not_null

          - name: line_total
            description: "Total cost of this line item."
            tests:
              - not_null

      - name: loyalty_points
        description: "Customer loyalty earnings."
        columns:
          - name: loyalty_id
            description: "Primary key for loyalty entries."
            tests:
              - not_null
              - unique

          - name: customer_id
            description: "Links to customers.customer_id."
            tests:
              - not_null
              - relationships:
                  arguments:
                    to: source('raw_cowjacket', 'customers')
                    field: customer_id

          - name: points_earned
            description: "Number of points earned in this transaction."
            tests:
              - not_null

          - name: transaction_date
            description: "Date when the loyalty points were earned."
            tests:
              - not_null
              
          - name: source
            description: "Source of loyalty points (purchase, promo, etc)."
            tests:
              - not_null
